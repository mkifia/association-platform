# ================================================================
# ASSOCIATION PLATFORM - ENVIRONMENT VARIABLES
# ================================================================
# Copy this file to .env and adjust values for your environment

# ==================== GENERAL ====================
APP_ENV=dev
APP_DEBUG=true
APP_SECRET=ChangeThisSecretKeyInProduction

# ==================== DATABASES ====================
# Master database for tenant management
DATABASE_MASTER_URL=postgresql://postgres:postgres@postgres-master:5432/master_db

# Metrics database for analytics
DATABASE_METRICS_URL=postgresql://postgres:postgres@postgres-metrics:5432/metrics_db

# Dynamic tenant database URL template (will be replaced per tenant)
DATABASE_TENANT_URL=postgresql://postgres:postgres@postgres-master:5432/tenant_{TENANT_ID}

# ==================== REDIS CACHE ====================
REDIS_URL=redis://redis:6379

# Redis database allocation per service
REDIS_DB_OPERATOR=0
REDIS_DB_PLATFORM=1
REDIS_DB_MEMBER=2
REDIS_DB_BFF_OPERATOR=3
REDIS_DB_BFF_PLATFORM=4
REDIS_DB_BFF_MEMBER=5

# ==================== JWT AUTHENTICATION ====================
JWT_SECRET_KEY=%kernel.project_dir%/config/jwt/private.pem
JWT_PUBLIC_KEY=%kernel.project_dir%/config/jwt/public.pem
JWT_PASSPHRASE=YourJWTPassphrase
JWT_TTL=3600

# ==================== KEYCLOAK ====================
KEYCLOAK_SERVER_URL=http://keycloak:8080
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_REALM_MASTER=master
KEYCLOAK_REALM_PLATFORM=platform
KEYCLOAK_REALM_MEMBERS=members

# Keycloak client credentials for each service
KEYCLOAK_CLIENT_ID_OPERATOR=operator-client
KEYCLOAK_CLIENT_SECRET_OPERATOR=your-operator-client-secret

KEYCLOAK_CLIENT_ID_PLATFORM=platform-client  
KEYCLOAK_CLIENT_SECRET_PLATFORM=your-platform-client-secret

KEYCLOAK_CLIENT_ID_MEMBER=member-client
KEYCLOAK_CLIENT_SECRET_MEMBER=your-member-client-secret

# ==================== STRIPE PAYMENT ====================
STRIPE_PUBLISHABLE_KEY=pk_test_51234567890abcdef...
STRIPE_SECRET_KEY=sk_test_51234567890abcdef...
STRIPE_WEBHOOK_SECRET=whsec_1234567890abcdef...

# Stripe webhook endpoints (must be accessible from internet in production)
STRIPE_WEBHOOK_ENDPOINT_PLATFORM=https://api-platform.yourdomain.com/stripe/webhook
STRIPE_WEBHOOK_ENDPOINT_MEMBER=https://api-member.yourdomain.com/stripe/webhook

# ==================== EMAIL CONFIGURATION ====================
MAILER_DSN=smtp://mailhog:1025

# Production email settings (uncomment for production)
# MAILER_DSN=smtp://username:password@smtp.gmail.com:587
# MAILER_FROM_EMAIL=noreply@association-platform.com
# MAILER_FROM_NAME="Association Platform"

# ==================== API URLS ====================
# Internal service URLs (Docker network)
OPERATOR_API_URL=http://operator-api:80
PLATFORM_API_URL=http://platform-api:80  
MEMBER_API_URL=http://member-api:80

# External URLs for frontend applications
NEXT_PUBLIC_API_URL_OPERATOR=http://bff-operator.localhost
NEXT_PUBLIC_API_URL_PLATFORM=http://bff-platform.localhost
NEXT_PUBLIC_API_URL_MEMBER=http://bff-member.localhost

# ==================== FRONTEND CONFIGURATION ====================
# NextJS Configuration
NEXTAUTH_SECRET=your-nextauth-secret-key
NEXTAUTH_URL=http://platform.localhost

# Keycloak configuration for frontend
NEXT_PUBLIC_KEYCLOAK_URL=http://localhost:8080
NEXT_PUBLIC_KEYCLOAK_REALM=platform
NEXT_PUBLIC_KEYCLOAK_CLIENT_ID=platform-client

# Stripe public key for frontend
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51234567890abcdef...

# ==================== CORS CONFIGURATION ====================
CORS_ALLOW_ORIGIN=^https?://(localhost|127\.0\.0\.1|.*\.localhost)(:[0-9]+)?$

# Production CORS (uncomment for production)  
# CORS_ALLOW_ORIGIN=^https?://(yourdomain\.com|.*\.yourdomain\.com)$

# ==================== FILE STORAGE ====================
# Local storage for development
UPLOAD_PATH=/var/uploads
MAX_UPLOAD_SIZE=10M

# Production storage (uncomment for production)
# AWS_S3_BUCKET=association-platform-uploads
# AWS_S3_REGION=eu-west-1  
# AWS_ACCESS_KEY_ID=your-aws-access-key
# AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# ==================== MONITORING & LOGGING ====================
LOG_LEVEL=debug

# Application monitoring (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
# DATADOG_API_KEY=your-datadog-api-key

# ==================== MULTI-TENANT CONFIGURATION ====================
TENANT_RESOLUTION_METHOD=subdomain  # subdomain|jwt|header
DEFAULT_TENANT_ID=default
MASTER_DOMAIN=localhost

# Tenant database creation settings
AUTO_CREATE_TENANT_DB=true
TENANT_DB_PREFIX=tenant_
MAX_TENANTS_PER_INSTANCE=1000

# ==================== CACHE CONFIGURATION ====================
CACHE_DEFAULT_TTL=3600
CACHE_NAMESPACE=association_platform

# Cache TTL per data type (seconds)
CACHE_TTL_USER_PROFILE=1800     # 30 minutes
CACHE_TTL_ASSOCIATION_DATA=900   # 15 minutes  
CACHE_TTL_CONTRIBUTIONS=300      # 5 minutes
CACHE_TTL_REPORTS=3600          # 1 hour

# ==================== RATE LIMITING ====================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_REQUESTS_PER_HOUR=1000

# ==================== FEATURE FLAGS ====================
FEATURE_MOBILE_APP=false
FEATURE_ADVANCED_REPORTS=true
FEATURE_AUTOMATED_REMINDERS=false
FEATURE_MULTI_LANGUAGE=false
FEATURE_WHITE_LABEL=false

# ==================== SECURITY ====================
BCRYPT_ROUNDS=12
SESSION_LIFETIME=7200  # 2 hours
CSRF_PROTECTION=true

# Security headers
SECURE_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000

# ==================== API CONFIGURATION ====================
API_RATE_LIMIT_PER_MINUTE=100
API_PAGINATION_DEFAULT_LIMIT=25
API_PAGINATION_MAX_LIMIT=100

# API versioning
API_VERSION=v1
API_DEPRECATED_VERSIONS=

# ==================== BACKGROUND JOBS ====================
MESSENGER_TRANSPORT_DSN=redis://redis:6379/messages

# Queue configuration
QUEUE_DRIVER=redis
QUEUE_HIGH_PRIORITY_WORKERS=2  
QUEUE_DEFAULT_WORKERS=4
QUEUE_LOW_PRIORITY_WORKERS=1

# ==================== DEVELOPMENT TOOLS ====================
# Enable development tools in non-production
ENABLE_DEBUG_TOOLBAR=true
ENABLE_PROFILER=true
ENABLE_SWAGGER_UI=true

# Testing configuration
TESTING_DATABASE_URL=sqlite:///%kernel.project_dir%/var/test.db
TESTING_REDIS_URL=redis://redis:6379/15

# ==================== PRODUCTION OVERRIDES ====================
# These should be set in production environment

# SSL/TLS Configuration
# HTTPS_ENABLED=true
# SSL_REDIRECT=true

# Database connection pooling  
# DATABASE_POOL_SIZE=20
# DATABASE_MAX_CONNECTIONS=100

# Production URLs
# PLATFORM_BASE_URL=https://platform.yourdomain.com
# MEMBER_BASE_URL=https://member.yourdomain.com  
# OPERATOR_BASE_URL=https://operator.yourdomain.com

# Production email
# MAIL_DRIVER=ses
# AWS_SES_REGION=eu-west-1

# Production cache
# CACHE_DRIVER=redis
# REDIS_CLUSTER_ENABLED=true
# REDIS_SENTINELS=redis-sentinel-1:26379,redis-sentinel-2:26379

# ==================== END OF CONFIGURATION ====================
